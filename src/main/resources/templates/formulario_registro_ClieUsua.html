<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Crear Cuenta Personal</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        body {
            font-family: 'Open Sans', sans-serif;
            background-image: linear-gradient(rgba(190, 79, 255, 0.5), rgba(248, 99, 186, 0.5), rgba(250, 120, 222, 0.5));
            margin: 0;
            padding: 0;
            background-size: cover;
        }

        .formulario-contenedor {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 1000px;
            margin: 50px auto;
        }



        .formulario-contenedor .contenedor-titulo-imagen {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1px;
        }

        .formulario-contenedor .contenedor-titulo-imagen .logo {
            display: block;
            margin: auto;
            align-items: center;
        }

        .formulario-contenedor .contenedor-titulo-imagen .logo img {
            width: 100px;
            height: 50px;
            max-width: 100%;
            height: auto;
            display: block;
            margin: auto;
            border-radius: 5px;
        }

        .formulario-contenedor .contenedor-titulo-imagen h1 {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            font-size: 40px;
            text-align: center;
            color: #797979;
            margin-top: 25px;
            margin: auto;
        }

        /* Form styles */
        form {
            width: 100%;
            margin: 0 auto;
            background-color: rgba(221, 221, 221, 0.5);
            /* Fondo blanco con transparencia */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 16px;
            text-align: left;
        }

        label {
            display: block;
            font-weight: bold;
            color: #023dff;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: calc(100% - 24px);
            padding: 10px;
            margin-top: 8px;
            margin-bottom: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            color: #333;
            background-color: #f9f9f9;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            border-color: #30d5c8;
            outline: none;
        }

        .formulario-contenedor .error-message {
            color: red;
            font-weight: bold;
            margin-bottom: 22px;
            text-align: center;
        }

        .formulario-contenedor .botones {
            display: flex;
            justify-content: center;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;

        }

        .formulario-contenedor .botones button {
            flex: 1;
            margin: 0 10px;
            text-align: center;
            font-size: 16px;
            background-color: #00aeff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }

        .formulario-contenedor .botones button:hover {
            background-color: #004a99;
        }
    </style>
</head>

<body>
    <div class="formulario-contenedor">
        <div class="contenedor-titulo-imagen">
            <h1>Crear Cuenta Personal</h1>
            <div class="logo">
                <img src="../static/img/LogoRobot.png" th:src="@{/img/LogoRobot.png}" alt="Logo">
            </div>
        </div>
        <div th:if="${error}" class="error-message" th:text="${error}"></div>
        <form id="formulario_registro" th:action="@{/kefa/registrar}" th:object="${usuarioRegistroTO}" th:method="POST"> 
            <table>
                <tr>
                    <td><label>Nombre y Apellido:</label></td>
                    <td><input type="text" placeholder="John Castillo" required th:field="${usuarioRegistroTO.nombreYApellido}">
                    </td>
                </tr>
                <tr>
                    <td><label>Cedula:</label></td>
                    <td>
                        <input type="text" id="cedula" placeholder="1753341311" required
                            th:field="${usuarioRegistroTO.cedula}" onblur="verificarCedula()">
                    </td>
                </tr>
                <tr>
                    <td><label>Género:</label></td>
                    <td>
                        <select id="countries" th:field="${usuarioRegistroTO.genero}">
                            <option value=" ">Seleccione un Genero</option>
                            <option value="Femenino">Femenino</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label>Celular:</label></td>
                    <td>
                        <input type="text" id="celular" placeholder="0996006155" required
                            th:field="${usuarioRegistroTO.telefono}" pattern="09[0-9]{8}"
                            title="Ingrese un número de celular válido. Ejemplo: 0996006155" onblur="validarCelular()">
                        <span id="errorCelular" style="color:red; display:none;">Número de celular no válido. Asegúrese
                            de que tenga 10 dígitos y comience con 09.</span>
                    </td>
                </tr>
                <tr>
                    <td><label for="email">Correo
                            electrónico:</label></td>
                    <td><input type="text" id="email" placeholder="john.doe@company.com" required
                            th:field="${usuarioRegistroTO.correoElectronico}">
                    </td>
                </tr>
                <tr>
                    <td><label>Provincia:</label></td>
                    <td>
                        <select id="provinces" th:field="${usuarioRegistroTO.provincia}">
                            <option value="Seleccione">Seleccione una provincia</option>
                            <option value="Azuay">Azuay</option>
                            <option value="Bolivar">Bolivar</option>
                            <option value="Cañar">Cañar</option>
                            <option value="Carchi">Carchi</option>
                            <option value="Chimborazo">Chimborazo</option>
                            <option value="Cotopaxi">Cotopaxi</option>
                            <option value="El_oro">El oro</option>
                            <option value="Esmeraldas">Esmeraldas</option>
                            <option value="Galápagos">Galápagos</option>
                            <option value="Guayas">Guayas</option>
                            <option value="Imbabura">Imbabura</option>
                            <option value="Loja">Loja</option>
                            <option value="Los_ríos">Los Ríos</option>
                            <option value="Manabi">Manabi</option>
                            <option value="Morona_Santiago">Morona Santiago</option>
                            <option value="Napo">Napo</option>
                            <option value="Orellana">Orellana</option>
                            <option value="Pastaza">Pastaza</option>
                            <option value="Pichincha">Pichincha</option>
                            <option value="Santa_Elena">Santa Elena</option>
                            <option value="Santo_Domingo">Santo Domingo</option>
                            <option value="Sucumbios">Sucumbios</option>
                            <option value="Tungurahua">Tungurahua</option>
                            <option value="Zamora_Chinchipe">Zamora Chinchipe</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label>Ciudad:</label></td>
                    <td>
                        <select id="cities" th:field="${usuarioRegistroTO.ciudad}">
                            <option value="">Seleccione una ciudad</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label>Dirección Domiciliaria:</label></td>
                    <td><input type="text" placeholder="Alfonso Mora E21-12 y S2G" required
                            th:field="${usuarioRegistroTO.direccion}">
                    </td>
                </tr>
                <tr>
                    <td><label>Código Postal:</label></td>
                    <td><input type="text" id="codigo_postal" placeholder="170145" required
                            th:field="${usuarioRegistroTO.codigoPostal}"></td>
                </tr>
                <tr>
                    <td><label>Usuario:</label></td>
                    <td><input type="text" id="website-admin" placeholder="elonmusk"
                            th:field="${usuarioRegistroTO.nickname}"></td>
                </tr>
                <tr>
                    <td><label>Contraseña:</label></td>
                    <td><input type="password" id="password" placeholder="•••••••••" required
                            th:field="${usuarioRegistroTO.constrasenia}"></td>
                </tr>
                <tr>
                    <td><label>Repetir Contraseña:</label></td>
                    <td><input type="password" id="password" placeholder="•••••••••" required
                            th:field="${usuarioRegistroTO.constraseniaRepetir}"></td>
                </tr>
                <tr>
                    <td><label>¿Cuál es su color favorito?</label></td>
                    <td><input type="text" placeholder="Amarillo" required th:field="${usuarioRegistroTO.preguntaUno}">
                    </td>
                </tr>
                <tr>
                    <td><label>¿Cuál es el apellido de su abuela?</label></td>
                    <td><input type="text" placeholder="Pérez" required th:field="${usuarioRegistroTO.preguntaDos}">
                    </td>
                </tr>
                <tr>
                    <td><label>¿Cuál es su canción favorita?</label></td>
                    <td><input type="text" placeholder="Presiento" required
                            th:field="${usuarioRegistroTO.preguntaTres}"></td>
                </tr>
            </table>
            <div class="botones">
                <button type="submit">Registrar</button>
                <button type="button" onclick="window.location.href='/kefa/presentacion'">Regresar</button>
            </div>
        </form>
    </div>

    <!--
        This script validates the email input field when it loses focus.
        It checks if the entered email is in a valid format using a regular expression.
        If the email is not valid, it displays an alert message.
    -->
    <script>
        const emailInput = document.getElementById('email');
        emailInput.addEventListener('blur', function () {
            const email = emailInput.value;
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!regex.test(email)) {
                alert('Por favor, ingresa un correo electrónico válido.');
            }
        });
    </script>
    <script>
        /**
         * Validates a given identification number (cedula) using the Ecuadorian validation algorithm.
         * 
         * @param {string} cedula - The identification number to be validated.
         * @returns {boolean} - True if the cedula is valid, false otherwise.
         */
        function validarCedula(cedula) {
            if (cedula.length !== 10) {
                return false;
            }
            const provincia = parseInt(cedula.substring(0, 2), 10);
            if (provincia < 1 || provincia > 24) {
                return false;
            }
            const tercerDigito = parseInt(cedula.substring(2, 3), 10);
            if (tercerDigito > 5) {
                return false;
            }
            const coeficientes = [2, 1, 2, 1, 2, 1, 2, 1, 2];
            let suma = 0;
            for (let i = 0; i < coeficientes.length; i++) {
                let valor = coeficientes[i] * parseInt(cedula.charAt(i), 10);
                if (valor > 9) {
                    valor -= 9;
                }
                suma += valor;
            }
            const decenaSuperior = Math.ceil(suma / 10) * 10;
            const digitoVerificador = decenaSuperior - suma;
            return digitoVerificador === parseInt(cedula.charAt(9), 10);
        }

        function verificarCedula() {
            const cedula = document.getElementById('cedula').value;
            if (!validarCedula(cedula)) {
                alert('La cédula ingresada no es válida.');
                return false;
            }
        }
    </script>
    <!--
        This script contains a function called validarCelular, which is used to validate a phone number entered in the 'celular' input field.
        
        Parameters:
            - None
        
        Returns:
            - None
        
        Example Usage:
            - Add an 'onblur' event to the 'celular' input field and set it to 'validarCelular()' to trigger the validation when the user leaves the input field.
    -->
    <script>
        function validarCelular() {
            var celular = document.getElementById('celular').value;
            var mensajeError = document.getElementById('errorCelular');
            var patron = /^09[0-9]{8}$/;

            if (!patron.test(celular)) {
                mensajeError.style.display = 'block';
            } else {
                mensajeError.style.display = 'none';
            }
        }
    </script>
    <!--
        This script handles the dynamic population of cities based on the selected province.
        It listens for the 'change' event on the 'provinces' select element and updates the 'cities' select element accordingly.
        The list of provinces and their corresponding cities is defined in the 'provinciaCiudades' object.
        When a province is selected, the script retrieves the corresponding cities from the 'provinciaCiudades' object and populates the 'cities' select element with the options.
        If no cities are found for the selected province, the 'cities' select element is reset to its initial state.
    -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const provinciaCiudades = {
                Azuay: ["Cuenca", "Gualaceo", "Paute"],
                Bolivar: ["Guaranda", "Chillanes", "San Miguel"],
                Cañar: ["Azogues", "Biblián", "La Troncal"],
                Carchi: ["Tulcán", "Espejo", "Mira"],
                Chimborazo: ["Riobamba", "Alausí", "Guano"],
                Cotopaxi: ["Latacunga", "La Maná", "Saquisilí"],
                El_oro: ["Machala", "Arenillas", "Pasaje"],
                Esmeraldas: ["Esmeraldas", "Atacames", "Muisne"],
                Galápagos: ["Puerto Ayora", "Santa Cruz", "San Cristóbal"],
                Guayas: ["Guayaquil", "Daule", "Durán"],
                Imbabura: ["Ibarra", "Otavalo", "Cotacachi"],
                Loja: ["Loja", "Catamayo", "Zapotillo"],
                Los_ríos: ["Babahoyo", "Quevedo", "Ventanas"],
                Manabi: ["Portoviejo", "Manta", "Chone"],
                Morona_Santiago: ["Macas", "Gualaquiza", "Sucúa"],
                Napo: ["Tena", "Archidona", "El Chaco"],
                Orellana: ["Francisco de Orellana", "La Joya de los Sachas", "Loreto"],
                Pastaza: ["Puyo", "Mera", "Santa Clara"],
                Pichincha: ["Quito", "Machachi", "Cayambe"],
                Santa_Elena: ["Santa Elena", "Salinas", "La Libertad"],
                Santo_Domingo: ["Santo Domingo", "La Concordia", "Santo Domingo de los Tsáchilas"],
                Sucumbios: ["Nueva Loja", "Cuyabeno", "Lago Agrio"],
                Tungurahua: ["Ambato", "Baños", "Pelileo"],
                Zamora_Chinchipe: ["Zamora", "Yantzaza", "Nangaritza"],
            };

            const selectProvincias = document.getElementById('provinces');
            const selectCiudades = document.getElementById('cities');

            selectProvincias.addEventListener('change', function () {
                const provinciaSeleccionada = this.value;
                const ciudades = provinciaCiudades[provinciaSeleccionada] || [];
                selectCiudades.innerHTML = '<option value="">Seleccione una ciudad</option>'; // Reinicia el select de ciudades

                ciudades.forEach(function (ciudad) {
                    const opcion = new Option(ciudad, ciudad);
                    selectCiudades.add(opcion);
                });
            });
        });
    </script>
    <!--
        This script adds an event listener to the "formulario_registro" form element.
        When the form is submitted, it checks the value of the "codigo_postal" input field.
        If the value does not match the pattern /^\d{6}$/ (6 digits), it displays an alert message and prevents the form from being submitted.
    -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const formulario = document.getElementById('formulario_registro');
            const inputCodigoPostal = document.getElementById('codigo_postal');

            formulario.addEventListener('submit', function (event) {
                const codigoPostal = inputCodigoPostal.value;
                if (!/^\d{6}$/.test(codigoPostal)) {
                    alert('El código postal debe tener 6 dígitos.');
                    event.preventDefault(); // Evita que el formulario se envíe
                }
            });
        });
    </script>
</body>

</html>